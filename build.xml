<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." name="ise3_contentBuild" default="all">
    <description>
        Builds an ISE3-based website from a TEI dataset.
    </description>

    <taskdef resource="net/sf/antcontrib/antcontrib.properties"/>
    <taskdef name="schematron"
        classpath="lib/ant-schematron-2010-04-14.jar"
        classname="com.schematron.ant.SchematronTask"/>

    <import file="anttask/overridable.xml"/>
    
    <property name="source.dir" value="${basedir}/svn"/>
    <property name="source.data.dir" value="${source.dir}/data"/>
    <property name="utilities.dir" value="${basedir}/lib"/>
    <property name="site.dir" value="${basedir}/site"/>
    <property name="siteXml.dir" value="${site.dir}/xml"/>
    <property name="originalXml.dir" value="${siteXml.dir}/original"/>
    <property name="standaloneXml.dir" value="${siteXml.dir}/standalone"/>
    
    <property name="source.schema.dir" value="${source.dir}/sch"/>
    <property name="site.schema.dir" value="${site.dir}/sch"/>
    
    <fileset id="sourceXml" dir="${source.data.dir}">
        <include name="**/**.xml"/>
    </fileset>
    
    <fileset id="originalXml" dir="${originalXml.dir}">
        <include name="**/**.xml"/>
    </fileset>
    
    <fileset id="standaloneXml" dir="${standaloneXml.dir}">
        <include name="**/**.xml"/>
    </fileset>
    
    <fileset id="siteXhtml" dir="${site.dir}">
        <include name="**.html"/>
    </fileset>
    
    <!-- DIR STRUCTURES OF THE SITE
        
        site [site.dir]/
            xml [siteXml.dir]/
                original [originalXml.dir]/
                standalone [standaloneXml.dir]/
            HTML FILES-->
    
    <fileset id="schemaFiles" dir="${source.schema.dir}">
        <include name="**"/>
    </fileset>
    
    <!--We don't need schemas right away, because all of our data should be validated before hand-->
    
    
    <target name="init">

        <echo message="Cleaning up directories from old build..."/>
        <delete dir="${source.dir}"/>
        <delete dir="${site.dir}"/>
        <!--We now make the site dir, but the SVN dir is made for us-->
        <mkdir dir="${site.dir}"/>
        <echo message="Now exporting the SVN data into a data/dir"/>
        <exec executable="svn">
            <arg line="export https://revision.hcmc.uvic.ca/svn/ise3/ ${source.dir} --ignore-externals"/>
        </exec>
    </target>
    
    <target name="copyAuxFiles">
        <echo message="Copying over auxillary files (schema, etc)..."/>
        <copy todir="${site.schema.dir}">
           <fileset refid="schemaFiles"/>
        </copy>
    </target>
    
    <target name="createOriginalXml">
        <echo message="Creating (i.e. just flattening, for now) the original XML from the source XML..."/>
        <copy todir="${originalXml.dir}" flatten="true">
            <fileset refid="sourceXml"/>
        </copy>
    </target>
    
   

<!--
    <target name="package">
        <overridableProperties using="exist-app.properties"/>
        <zip destfile="build/${abbrev}-${version}.xar">
            <fileset dir="build/expath-pkg"/>
            <zipfileset dir="build/data" prefix="content"/>
            <zipfileset dir="web" prefix="content"/>
        </zip>
    </target>-->




    <target name="all" depends="init, copyAuxFiles, createOriginalXml"/>
    
    
</project>
